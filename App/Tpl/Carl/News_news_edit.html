<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8">
	<title> 后台数据管理中心</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="创高安防">
	<meta name="author" content="chuango_Karl">
	<script src="__PUBLIC__/Admin/ue/editor_config.js" type="text/javascript"></script>
	<script src="__PUBLIC__/Admin/ue/editor_all_min.js" type="text/javascript"></script>
	<include file="public:css" />
	<style type="text/css">
    	._modify_news_content, ._delete_news_content{ margin-bottom:20px; clear:both;}
		#addNewsSubContent{display:block;}
    </style>
</head>

<body>
	<include file="public:header" />
		<div class="container-fluid">
		<div class="row-fluid">
			<include file="public:left" />
			<!-- content start -->
			<div id="content" class="span10">
				<div>
					<ul class="breadcrumb">
						<li>
							<a href="__GROUP__/Index">Home</a> <span class="divider">/</span>
						</li>
						<li>
							<a href="__URL__/index">新闻列表</a> <span class="divider">/</span>
						</li>
                        <li>
							<a href="__URL__/news_edit/ne_id/{$news.ne_id}">{$news.ne_title}</a>
						</li>
					</ul>
				</div>
			<present name="msg">
            <div class="row-fluid">	
                <div class="alert alert-{$msg[0]}">
                    <button type="button" class="close" data-dismiss="alert">×</button>
                    <strong>系统提示:&nbsp;&nbsp;</strong> {$msg[1]}
                </div>
            </div>	
            </present>
            <div class="row-fluid sortable">
				<div class="box span12">
					<div class="box-header well" data-original-title>
						<h2><i class="icon-edit"></i>新闻管理</h2>
					</div>
					<div class="box-content">
						<form class="form-horizontal" action="__URL__/news_edit" method="post" enctype="multipart/form-data" >
                          <input type="hidden" name="action" value="edit" />
                          <input type="hidden" name="ne_id" value="{$news.ne_id}"
						  <fieldset>
							<legend>编辑新闻</legend>
							<div class="control-group">
							  <label class="control-label" for="ne_title">新闻标题<span class="red">*</span></label>
							  <div class="controls">
								<input type="text" class="span6 typeahead" id="ne_title" name="ne_title" value="{$news.ne_title}"  data-provide="typeahead" data-items="10" data-source='["[媒体关注]","[获奖信息]","[声明]","[参展信息]","[市场营销]"]' />
							  </div>
							</div>
                            <!--<div class="control-group">
							  <label class="control-label" for="ne_lang">选择语种</label>
							  <div class="controls">
								<select id="ne_lang" name="ne_lang">
                                	<option value="en">English</option>
                                    <option value="zh-cn">简体中文</option>
                                    <option value="zh-hk">繁體中文</option>
                                    <option value="fr">法语</option>
                                    <option value="ja">日语</option>
                                    <option value="ru">俄语</option>
                                </select>
							  </div>
							</div>-->
							<div class="control-group">
							  <label class="control-label" for="ne_time">新闻日期</label>
							  <div class="controls">
								<input type="text" class="input-xlarge datepicker" id="ne_time" value="{$news.ne_time|timeFormat='m/d/Y'}" name="ne_time" />
							  </div>
							</div>
							<div class="control-group">
							  <label class="control-label" for="ne_author">新闻作者</label>
							  <div class="controls">
								<input type="text" class="input-xlarge" id="ne_author" value="{$news.ne_author}" name="ne_author" />
							  </div>
							</div>
                            <div class="control-group">
							  <label class="control-label" for="ne_from">新闻来源</label>
							  <div class="controls">
								<input type="text" class="input-xlarge" id="ne_from" value="{$news.ne_from}" name="ne_from" />
							  </div>
							</div>
                            <div class="control-group">
							  <label class="control-label" for="ne_summary">新闻摘要</label>
							  <div class="controls">
								<textarea name="ne_summary" id="ne_summary" class="span6" rows="4" >{$news.ne_summary}</textarea>
							  </div>
							</div>
                            <div class="control-group">
							  <label class="control-label" for="ne_desc">新闻概述</label>
							  <div class="controls">
								<textarea name="ne_desc" id="ne_desc" class="span6" rows="4" >{$news.ne_desc}</textarea>
							  </div>
							</div>
                            <div class="control-group">
							  <label class="control-label" for="ne_keywords">新闻关键字</label>
							  <div class="controls">
								<textarea name="ne_keywords" id="ne_keywords" class="span6" rows="4" >{$news.ne_keywords}</textarea>
							  </div>
							</div>
							<div class="control-group">
							  	<label class="control-label" for="new_relatepro">相关产品</label>
							  	<div class="controls">
									<select data-placeholder="相关产品链接" id="new_relatepro" class="span6" name="ne_relatepro[]" multiple data-rel="chosen">
										{$pro_list|pro_options=$news['ne_relatepro']}
									</select>
								</div>
							</div> 
                            <div class="control-group">
							  <label class="control-label" for="ne_publish">发布状态</label>
							  <div class="controls">
								<input data-no-uniform="true" <if condition="$news['ne_publish'] eq 'on'">checked="checked"</if> type="checkbox" class="iphone-toggle" id="ne_publish" name="ne_publish" />
							  </div>
							</div>
                            <div class="control-group">
							  <label class="control-label" for="ne_top">是否置顶</label>
							  <div class="controls">
								<input data-no-uniform="true" <if condition="$news['ne_top'] eq 'on'">checked="checked"</if> type="checkbox" class="iphone-toggle" id="ne_top" name="ne_top" />
							  </div>
							</div>         
							<div class="control-group">
                            	
							  <label class="control-label" for="ne_content">新闻内容</label>
							  <div class="controls">
                              	<volist name="contents" id="content">
                              	<script type="text/plain" id="ne_content_{$content.nec_id}"></script>
                                <button type="button" class="btn btn-mini btn-warning _modify_news_content" data-id="{$content.nec_id}">修改内容</button>
                                <button type="button" class="btn btn-mini btn-danger _delete_news_content" data-id="{$content.nec_id}">删除本页</button>
                                </volist>
                                <button type="button" id="addNewsSubContent" class="btn btn-primary">添加新闻分页</button>
							  </div>
							</div>
							<div class="form-actions">
							  <button type="submit" class="btn btn-primary">保存</button>
							  <button type="reset" class="btn">取消</button>
							</div>
						  </fieldset>
						</form>   

					</div>
				</div>
			
			</div>
			<!-- content end -->
		</div>
		</div>
		<hr>
        <div class="ajax-loading"></div>
		<div class="modal hide fade" id="myModal">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">×</button>
				<h3>Settings</h3>
			</div>
			<div class="modal-body">
				<p>Here settings can be configured...</p>
			</div>
			<div class="modal-footer">
				<a href="#" class="btn" data-dismiss="modal">Close</a>
				<a href="#" class="btn btn-primary">Save changes</a>
			</div>
		</div>
		<include file="public:footer" />
	</div>
	<include file="public:js" />
    <script type="text/javascript">
		var _publicBaseUrl = '__PUBLIC__';
		<foreach name="contents" item="content">
			textareaInit('ne_content_{$content.nec_id}','{$content.nec_content}');
		</foreach>
		$(function(){
			var contentPage = 1;
			$("#addNewsSubContent").click(function(){
				contentPage++;;
				var newContent = $('script');
				newContent.attr("type","text/plain").attr("name","ne_content[]").attr("id","ne_content_"+contentPage);
				newContent.insertBefore($(this));
				textareaInit('ne_content_'+contentPage,'');
			});
			
			$("._modify_news_content").click(function(){
				var newsId = $("input[name='ne_id']").val();
				var contentId = $(this).attr("data-id");
				var content = UE.getEditor("ne_content_"+contentId).getContent();
				var _url = "__URL__/modifyNewsContent";
				var _data = {"ne_id":newsId,"nec_id":contentId,"nec_content":content};
				var n = noty({layout: 'center',
					text: '<img src="' + _publicBaseUrl + '/Admin/img/ajax-loaders/ajax-loader-6.gif" />',
					timeout: 0});
					$.post(_url, _data, function(response){
					$.noty.closeAll()
					bootbox.alert(response.msg);
				}, 'json');
			});
			
			$("._delete_news_content").click(function(){
				var newsId = $("input[name='ne_id']").val();
				var contentId = $(this).attr("data-id");
				var _url = "__URL__/deleteNewsContent";
				var _data = "ne_id=" + newsId + "&nec_id="+contentId;
				var n = noty({layout: 'center',
					text: '<img src="' + _publicBaseUrl + '/Admin/img/ajax-loaders/ajax-loader-6.gif" />',
					timeout: 1000});
				$.post(_url, _data, function(response){
					if(response.code=="0"){
						location.reload();	
					}else{
						$.noty.closeAll()
						bootbox.alert(response.msg);
					}
				}, 'json');
			});
		});
	</script>
</body>
</html>
